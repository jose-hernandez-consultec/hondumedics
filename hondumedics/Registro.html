<!DOCTYPE html>
<html>

<head>
    <title>Regístrate en HonduMedics | Paciente</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- JQuery JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="../js/amazon-cognito-identity.min.js"></script>
    <script src="../js/cognitoFunctions.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>



    <!-- Estilos CSS -->
    <style>
        .nav-wrapper {
            background-color: #FC5A5A;
        }

        .waves-effect.waves-pink .waves-ripple {
            background-color: #FC5A5A;
        }

        .btn-pink {
            background-color: #FC5A5A;
        }

        .btn-bordes {
            border: white 2px solid;
        }

        body {
            background-color: #ccc;
        }
    </style>
</head>

<body>
    <!-- Formulario de Registro -->
    <div class="row">
        <nav class="nav-wrapper">
            <div class="col s1"></div>
            <div class="col s11">
                <a href="index.html" class="brand-logo">HonduMedics</a>
            </div>
        </nav>
    </div>
    <div class="container">
        <div class="container">
            <div class="row">
                <br>
                <br>
                <br>
                <div class="card">
                    <form id="formulario" name="formulario" method="POST">
                        <div class="col s1"></div>
                        <div class="col s11">
                            <p style="text-align: center;">
                                <h3>Crea una cuenta</h3>
                            </p>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="col s11">
                                <a href="Login.html" id="linkIniciarSesion"><span>¿Ya tienes uno? Iniciar
                                        Sesión</span></a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="input-field col s10">
                                <input id="email" type="email" class="validate">
                                <label for="email">Introduce tu correo electrónico</label>
                            </div>
                            <div class="col s1"></div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="input-field col s10">
                                <input id="password" type="password" class="validate"
                                    placeholder="Por lo menos 8 caracteres de longitud">
                                <label for="password">Contraseña</label>
                            </div>
                            <div class="col s1"></div>
                            <!--<div class="col s12">
                            <p><b>Reglas de contraseña</b></p>
                            <p style="font-family: Arial, Helvetica, sans-serif; font-size: small;">1. Tiene al menos 8
                                caracteres</p>
                            <p style="font-family: Arial, Helvetica, sans-serif; font-size: small;">2. Tiene letras,
                                números
                                y caracteres especiales</p>
                            <p style="font-family: Arial, Helvetica, sans-serif; font-size: small;">3. No tiene
                                caracteres
                                de espacio en blanco</p>
                            <p style="font-family: Arial, Helvetica, sans-serif; font-size: small;">4. No es fácil de
                                adivinar</p>
                        </div>-->
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="col s11">
                                <p style="text-align: center;">
                                    <h5>Tu nombre</h5>
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="input-field col s5 m5">
                                <input placeholder="Escribe su nombre" id="nombre" type="text" class="validate">
                                <label for="nombre">Nombre</label>
                            </div>
                            <div class="input-field col s5 m5">
                                <input placeholder="Escribe su apellido" id="apellido" type="text" class="validate">
                                <label for="apellido">Apellido</label>
                            </div>
                            <div class="col s1"></div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="col s11">
                                <p style="text-align: center;">
                                    <h5>Fecha de Nacimiento</h5>
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <div class="input-field col s10">
                                <input type="text" class="datepicker" id="birthday" name="birthday">
                            </div>
                            <div class="col s1"></div>
                        </div>
                        <div class="row">
                            <div class="col s1"></div>
                            <fieldset class="col s10">
                                <legend>
                                    <h4>Sexo</h4>
                                </legend>
                                <center>
                                    <form id="form2">
                                        <p>
                                            <label>
                                                <input id="male" class="with-gap" name="gender" type="radio"
                                                    value="1" />
                                                <span>Masculino</span>
                                            </label>
                                        </p>
                                        <p>
                                            <label>
                                                <input id="female" class="with-gap" name="gender" type="radio"
                                                    value="2" />
                                                <span>Femenino</span>
                                            </label>
                                        </p>
                                    </form>
                        </div>
                        </center>
                        </fieldset>
                        <div class="col s1"></div>
                        <div class="row">
                            <form action="#" id="form3">
                                <p>
                                    <label>
                                        <input id="aceptar" class="filled-in" name="aceptar" type="checkbox" />
                                        <span>He leído y acepto los
                                            <a href="">Términos de uso </a> y <a href="">la Política de privacidad
                                                de</a>
                                            HonduMedics</span>
                                    </label>
                                </p>
                                <!--<div class="row">
                                <p>
                                    <label>
                                        <input id="mantener" type="checkbox" class="filled-in" checked="checked" name="valor1" />
                                        <span>Mantenme conectado</span>
                                    </label>
                                </p>
                            </div>-->
                            </form>
                        </div>
                        <div class="row">
                            <div class="col s12 m4 l4">
                                <p></p>
                            </div>
                            <center>
                                <div class="col s12 m4 l4"><a href="#"
                                        class="btn tooltipped btn-pink white-text waves-effect waves-pink btn-large"
                                        id="btnGuardar" data-position="left" data-tooltip="Guardar registro.">Guardar<i
                                            class="material-icons left">save</i></a></div><br><br>
                            </center>
                            <div class="col s12 m4 l4">
                                <p></p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>


    <script>
        //Este método se utiliza para hacer que una función esté disponible después de cargar el documento.
        $(document).ready(function () {
            //Inicialización de las propiedades de Materialize css.
            $('.datepicker').datepicker();
            $('.tooltipped').tooltip();

            var form = $("#formulario");
            var form2 = $("#form2");

            //El método click() adjunta una función de controlador de eventos a un elemento HTML.
            //La función se ejecuta cuando el usuario hace clic en el elemento HTML.
            $("#btnGuardar").click(function (e) {

                e.preventDefault(); //Detiene la acción predeterminada de un elemento.

                //Obtener campos de entradas del formulario, Obtener el valor de un elemento .val()
                var email_registro = $('#email').val();
                //var email2_registro = $('#email2').val();
                var password_registro = $('#password').val();
                var nombre_registro = $('#nombre').val();
                var apellido_registro = $('#apellido').val();
                var fecha_registro = $('#birthday').val();
                var select_gender = Number($('input[name="gender"]').is(':checked'));
                var aceptar_condiciones = Number($('#aceptar').is(':checked'));

                //Validar que nada este vacio
                var valido = true;
                if (email_registro === "" || email_registro.length === 0) {
                    alert("El Correo Electrónico Está vacío");
                    valido = false;
                }

                /* if (email2_registro == "" || email2_registro.length === 0) {
                     alert("La Confirmación De Correo Electrónico Está Vacía");
                     valido = false;
                 }*/

                if (password_registro == "" || password_registro.length === 0) {
                    alert("La Contraseña Está Vacía");
                    valido = false;
                }

                if (nombre_registro == "" || nombre_registro.length === 0) {
                    alert("El Nombre Está Vacío");
                    valido = false;
                }

                if (apellido_registro == "" || apellido_registro.length === 0) {
                    alert("El Apellido Está Vacío");
                    valido = false;
                }
                
                console.log(fecha_registro);
                if (fecha_registro == "") {
                    alert("La Fecha Está Vacía");
                    valido = false;
                }

                //parseInt() es una función de alto nivel que sirve para parsear una cadena e intentar obtener un valor numérico.
                console.log(parseInt(select_gender));

                if (parseInt(select_gender) != 1 && parseInt(select_gender) != 2) {
                    alert("Seleccione La Opción De Género");
                    valido = false;
                }

                // si la cantidad de checkboxes "chequeados" es cero, entonces se evita que se envíe el formulario y se muestra una alerta al usuario
                /*if (aceptar_condiciones) {
                    alert('Campo Correcto');
                } else {
                    alert('Debe Aceptar Las Condiciones');
                    valido = false;
                }*/

                /*$('#aceptar').change(function(){
                    var aceptar_condiciones = false;
                    if(this.checked){
                        aceptar_condiciones = true;
                    }
                    //alert(aceptar_condiciones);
                });*/

                //parseInt() es una función de alto nivel que sirve para parsear una cadena e intentar obtener un valor numérico.
                console.log(parseInt(aceptar_condiciones));

                if (parseInt(aceptar_condiciones) != 0 && parseInt(aceptar_condiciones) != 1) {
                    alert("Debe Aceptar Las Condiciones");
                    valido = false;
                }

                //Método Ajax, permite al navegador enviar y recibir datos en  el fondo (background).
                if (valido) {
                    $.ajax({
                        url: 'https://hondumedics-server.herokuapp.com/patients/addNewPatient',
                        dataType: 'json',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ "email": email_registro, "password": password_registro, "first_name": nombre_registro, "last_name": apellido_registro, "birthdate": fecha_registro, "gender": select_gender, "tos_approved": aceptar_condiciones }),
                        processData: false,
                        success: function (data) {
                            console.log(data);
                            if (data.added) {
                                alert("Agregue nuevo usuario");
                                //Redireccionando a login.html y enviando dos paraemtros hacia esa pagina: first_name y last_name
                                window.location.href = "./login.html";

                                form[0].reset();
                            }
                        },
                        error: function (error) {
                            console.log(error);
                            if (error.status === 403) {
                                alert("Ya existe un usuario con ese correo electrónico!");
                            }
                        }
                    });
                } else {
                    alert("Hay errores en el formulario");
                }
            });

        });
    </script>
</body>

</html>