<!DOCTYPE html>
<html>

<head>
    <title>Hospital / Administrador</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- JQuery JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--DataTable-->
    <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

    <!-- Estilos CSS -->

    <style>
        .nav-wrapper {
            background-color: #464646;
        }

        .waves-effect.waves-pink .waves-ripple {
            background-color: #464646;
        }

        .btn-pink {
            background-color: #464646;
        }

        .btn-bordes {
            border: white 2px solid;
        }

        .page-footer {
            background: #464646;
        }

        #topbarsearch .input-field .prefix {
            width: 0rem !important;
        }

        #topbarsearch nav ul li:hover,
        nav ul li.active {
            background-color: none !important;
        }

        .input-field .prefix~input,
        .input-field .prefix~textarea,
        .input-field .prefix~label,
        .input-field .prefix~.validate~label,
        .input-field .prefix~.autocomplete-content {
            margin-left: 1rem !important;
        }

        .dropdown-content {
            background-color: #FFFFFF;
            margin: 0;
            display: none;
            min-width: 300px;
            /* Changed this to accomodate content width */
            max-height: auto;
            margin-left: -1px;
            /* Add this to keep dropdown in line with edge of navbar */
            overflow: hidden;
            /* Changed this from overflow-y:auto; to overflow:hidden; */
            opacity: 0;
            position: absolute;
            white-space: nowrap;
            z-index: 1;
            will-change: width, height;
        }

        #back1 {
            z-index: 10;
            position: relative;
        }

        #back2 {
            z-index: 10;
            position: relative;
        }

        #back3 {
            z-index: 0;
            position: relative;
        }

        #back4 {
            z-index: 0;
            position: relative;
        }

        .content {
            padding-left: 300px;
            height: 100%;
        }

        .card-bg {
            background: white;
        }

        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            -ms-overflow-style: -ms-autohiding-scrollbar;
        }

        .imgRedonda {
            width: 60px;
            height: 60px;
            border-radius: 150px;
        }

        .container-1 {
            width: 100%;
            max-width: initial;
        }

        .container-1>.row {
            margin: 0;
        }

        .container-1>.row>.col {
            padding: 0;
        }

        table {
            width: 100%;
            height: 50½;
            text-align: center;
        }

        th {
            text-align: center;
        }

        td {
            width: 0px;
            height: 30px;
            text-align: center;
        }

        .modal {
            left: 0;
            right: 0;
            background-color: white;
            padding: 0;
            width: 50%;
            will-change: top, opacity;
            max-height: 100%;
        }

        .modal .modal-footer {
            border-radius: 0 0 2px 2px;
            background-color: white;
            padding: 4px 6px;
            height: 45px;
            width: 100%;
            text-align: center;
        }

        .modal-form-row {
            margin-bottom: 0px;
        }

        .sidenav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 22%;
            will-change: opacity;
        }
    </style>
</head>

<body>
    <!--Formulario de Lista de Hospitales-->
    <!--Navbar-->
    <div class="row">
        <nav class="nav-wrapper">
            <div class="nav-wrapper">
                <a href="" class="left sidenav-trigger hide-on-medium-and-up" data-target="sidenav-1">
                    <i class="material-icons">menu</i></a>
                <div class="col s3"></div>
                <div class="col s9">
                    <a class="brand-logo link-dashboard">HM Admin Panel</a>
                    <ul class="right hide-on-med-and-down">
                        <!-- Dropdown Trigger -->
                        <li>
                            <a href="#" class="dropdown-trigger" data-target="dropdown1">
                                Hola, <span style="font-size: 15px; font-weight: bold;" id="username"></span>
                                <i class="material-icons right">arrow_drop_down</i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <!-- Dropdown Structure -->
    <ul id='dropdown1' class='dropdown-content'>
        <li><a href="CerrarSesion.html">
                <span style="color: #464646;">
                    <center>Cerrar Sesión</center>
                </span>
            </a></li>
    </ul>

    <!--Menú Oculto-->
    <ul class="sidenav sidenav-fixed" id="sidenav-1">
        <li>
            <div class="user-view">
                <div class="background">
                    <img src="https://hdblackwallpaper.com/wallpaper/2015/04/1200-x-900-solid-black-wallpaper-22-wide-wallpaper.jpg"
                        style="height: 100%; width: 100%;" alt="" class="responsive-img">
                </div>
                <span class="white-text name"><span style="font-size: 15px; font-weight: bold;" id="username1"></span>
                    <span class="white-text email"><span id="email1"></span>
            </div>
        </li>
        <li>
            <a class="link-dashboard"><i class="material-icons black-text">dashboard</i>Dashboard
            </a>
        </li>
        <li>
            <a class="link-pacientes"><i class="material-icons black-text">person</i>Pacientes
            </a>
        </li>

        <li>
            <a class="link-doctores"><i class="material-icons black-text">people</i>Doctores
            </a>
        </li>
        <li>
            <a class="link-solicitudes"><i class="material-icons black-text">assignment_turned_in</i>Solicitudes
            </a>
        </li>
        <li>
            <a class="link-solicitudes-rechazadas"><i class="material-icons black-text">cancel</i>Solicitudes Rechazadas
            </a>
        </li>
        <li>
            <a class="link-citas"><i class="material-icons black-text">date_range</i>Citas
            </a>
        </li>
        <li>
            <a class="link-hospitales"><i class="material-icons black-text">local_hospital</i>Hospitales
            </a>
        </li>
        <li>
            <a class="link-especialidades"><i class="material-icons black-text">colorize</i>Especialidades
            </a>
        </li>
        <div class="divider"></div>

        <li>
            <a class="link-agregar-nuevo-usuario"><i class="material-icons black-text">add</i>Agregar Nuevo Usuario
            </a>
        </li>
        <li>
            <a href=""><i class="material-icons black-text">exit_to_app</i>Cerrar Sesión
            </a>
        </li>
    </ul>
    <!--SideNav Finished-->

    <!--Panel Lista de Hospitales-->
    <div class="" style="min-height: 657px;">
        <form id="form1">
            <div class="container-1">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="row">
                        <div class="col s3"></div>
                        <div class="col s9">
                            <h3 class="black-text center">Hospitales</h3>
                            <!--<h6 class="blue-text center"><b>Dashboard / Usuarios /</b> Doctores</h6>-->
                        </div>
                        <!--Lista Hospitales-->
                        <div class="row">
                            <div class="col s3"></div>
                            <div class="col s9 l9">
                                <!--<br>
                                <br>
                                <br>-->
                                <!--Añadir Hospitales-->
                                <!--Modal Trigger-->
                                <a class="waves-effect waves-light btn blue modal-trigger col s12 m6 l3"
                                    href="#modal1"><i class="material-icons left">add</i>Añadir Hospital</a>
                                <br>
                                <br>

                                <!--Modal Structure -->
                                <div id="modal1" class="modal">
                                    <div class="modal-content center">
                                        <h4>AGREGAR HOSPITAL</h4>

                                        <div class="row">
                                            <form class="col s12" id="FormHospital">
                                                <div class="row modal-form-row">
                                                    <div class="input-field col s12">
                                                        <input id="nombre_hospital" type="text" class="validate">
                                                        <label for="nombre_hospital">Nombre del Hospital</label>
                                                    </div>
                                                    <div class="input-field col s12">
                                                        <input id="ciudad" type="text" class="validate">
                                                        <label for="ciudad">Ciudad</label>
                                                    </div>
                                                    <div class="input-field col s12">
                                                        <input id="departamento" type="text" class="validate">
                                                        <label for="departamento">Departamento</label>
                                                    </div>
                                                    <div class="input-field col s12">
                                                        <textarea id="direccion"
                                                            class="materialize-textarea"></textarea>
                                                        <label for="direccion">Dirección</label>
                                                    </div>
                                                    <div class="input-field col s12">
                                                        <input id="pais" type="text" class="validate">
                                                        <label for="pais">País</label>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <center>
                                                <a href=""
                                                    class="btnAgregar modal-action modal-close waves-effect waves-red btn white-text center"
                                                    style="background-color: #2196f3; font-weight: bold;">Agregar</a>
                                                <a href=""
                                                    class=" btnCancelar modal-action modal-close waves-effect waves-red btn white-text center"
                                                    style="background-color: red; font-weight: bold;">Cancelar</a>
                                            </center>
                                        </div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-content">
                                        <table id="example" class="display highlight" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>NOMBRE</th>
                                                    <th>CIUDAD</th>
                                                    <th>DEPARTAMENTO</th>
                                                    <th>DIRECCIÓN</th>
                                                    <th>PAÍS</th>
                                                    <th>ACCIONES</th>
                                                </tr>
                                            </thead>

                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        //Este método se utiliza para hacer que una función esté disponible después de cargar el documento.
        $(document).ready(function () {
            //Inicialización de las propiedades de Materialize css.
            M.AutoInit();
            $('.sidenav').sidenav();
            $('.sidenav-1').sidenav({ edge: 'left' });
            $('.sidenav-trigger').sidenav();
            $('.dropdown-trigger').dropdown({
                coverTrigger: false,
                belowOrigin: true
            });
            $('.modal').modal();

            //Obteniendo los parametros enviados luego de hacer login, estos vienen en el URL, fueron enviados del archivo de LoginAdmin.html
            var first_name = getQueryVariable("first_name");
            var last_name = getQueryVariable("last_name");
            var email = getQueryVariable("email");

            $("#username").text(decodeURIComponent(first_name));
            $("#username1").text(decodeURIComponent(first_name + " " + last_name));
            $("#email1").text(decodeURIComponent(email));

            //Funcion que hace consultas al URL, recibe el nombre del parametro que queres obtener y te devuelve el valor del parametro
            function getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (pair[0] == variable) {
                        return pair[1];
                    }
                }
                return false;
            }

            //Evento Click del link con clase llamada link-dashboard
            $(".link-dashboard").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./dashboard.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-pacientes
            $(".link-pacientes").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./ListaPacientes.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-doctores
            $(".link-doctores").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./ListaDoctores.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-solicitudes
            $(".link-solicitudes").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./SolicitudesDeDoctores.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-solicitudes-rechazadas
            $(".link-solicitudes-rechazadas").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./SolicitudesRechazadas.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-citas
            $(".link-citas").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./ListaCitas.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-citas
            $(".link-hospitales").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 890, 891 y 892 respectivamente
                window.location.href = "./Hospitales.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-citas
            $(".link-especialidades").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 890, 891 y 892 respectivamente
                window.location.href = "./Especialidades.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-agregar-nuevo-usuario
            $(".link-agregar-nuevo-usuario").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 612, 613 y 614 respectivamente
                window.location.href = "./AgregarNuevoUsuario.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-perfil-doctor
            $(".link-perfil-doctor").click(function () {

                //las variables first_name, last_name y email estan declaradas en las lineas 890, 891 y 892 respectivamente
                window.location.href = "./UserProfileDoctor.html?first_name=" + first_name + "&last_name=" + last_name + "&email=" + email;
            });

            //Evento Click del link con clase llamada link-citas
            $(".link-editar-hospitales").click(function () {
                //las variables first_name y last_name estan declaradas en las lineas 667 y 668 respectivamente
                window.location.href = "./editarHospitales.html";
            });

            $.ajax({
                url: 'http://localhost:5000/hospitals',
                type: 'GET',
                dataType: 'json', //added data
                success: function (data) {
                    console.log(data);
                    var datos = data;
                    var tabla;
                    tabla = $("#example").DataTable();
                    for (var i = 0; i <= datos.length; i++) {
                        if (datos[i] != undefined) { //Validar de que el ID no venga nulo o indefinido

                            tabla.row.add([/*datos[i].patient_id,*/ datos[i].hospital_name, datos[i].city, datos[i].department, datos[i].direction, datos[i].country]);
                        }
                        tabla.draw();

                    }
                }
            });

            //Método Ajax, permite al navegador enviar y recibir datos en  el fondo (background).
            $.ajax({
                url: '',
                type: 'GET',
                dataType: 'json', //added data
                success: function (data) {
                    console.log(data);
                    var datos = data;
                    var tabla;
                    tabla = $("#example").DataTable();
                    for (var i = 0; i <= datos.length; i++) {
                        if (datos[i] != undefined) { //Validar de que el ID no venga nulo o indefinido
                            $('.tooltiped').tooltip();
                            //Se eliminó el atributo ID y el id se agregó como una clase
                            //Se le agregó el atributo data-adminid a cada uno de los 3 botones
                            $("#example").append('<tr>' + '<td>' + datos[i].hospital_name + '</td>' +
                                '<td>' + datos[i].city + '</td>' +
                                '<td>' + datos[i].department + '</td>' +
                                '<td>' + datos[i].directions + '</td>' +
                                '<td>' + datos[i].country + '</td>' +
                                '<td><a style="position:relative; z-index:0;" class="btnEditar btn-floating btn-small waves-effect waves-light green btn tooltipped center" data-position="bottom" data-tooltip="Editar" data-hospitalid=' + datos[i].hospital_id + ' data-hospitalname=' + datos[i].hospital_name + ' data-city=' + datos[i].city + ' data-department=' + datos[i].department + ' data-directions=' + datos[i].directions + ' data-country=' + datos[i].country + '><i class="material-icons">edit</i></a><a style="position:relative; z-index:0;" class="btnEliminar btn-floating btn-small waves-effect waves-light red btn tooltipped center" data-position="bottom" data-tooltip="Eliminar" data-hospitalid=' + datos[i].hospital_id + '><i class="material-icons">delete_forever</i></a></td>' + '</tr>');

                        }


                    }
                    //El método click() adjunta una función de controlador de eventos a un elemento HTML.
                    //La función se ejecuta cuando el usuario hace clic en el elemento HTML.
                    //Función Click del boton Editar
                    $(".btnEditar").click(function () {
                        var hospital_id = parseInt($(this).attr("data-hospitalid"));
                        var hospital_name = String($(this).attr("data-hospitalname"));
                        var city = String($(this).attr("data-city"));
                        var department = String($(this).attr("data-department"));
                        var directions = String($(this).attr("data-directions"));
                        var country = String($(this).attr("data-country"));
                        console.log(hospital_id);
                        console.log("Editar");

                        //Redireccionando a editarAdministrador.html y enviando dos parámetros hacia esa página: first_name y last_name
                        //window.location.href = "./editarAdministrador.html?first_name=" + admin_first_name + "&last_name=" + admin_last_name;
                        window.location.href = "./editarHospitales.html?hospital_id=" + hospital_id + "&hospital_name=" + hospital_name + "&city=" + city + "&department=" + department + "&directions=" + directions + "&country=" + country;
                    });

                    //Función Click del boton Eliminar
                    $(".btnEliminar").click(function () {
                        //Declarar variable eliminar
                        var eliminar = this;

                        //Eliminar ID con atributo data
                        var hospital_id = $(this).data("doctorid");
                        console.log(hospital_id);
                        console.log("Eliminar");

                        if (confirm("¿Estás seguro de que deseas eliminar esta fila?")) {

                            //Método Ajax, permite al navegador enviar y recibir datos en  el fondo (background).
                            $.ajax({
                                url: '',
                                type: 'POST',
                                dataType: "json",
                                contentType: "application/json",
                                data: JSON.stringify({ "hospital_id": hospital_id }),
                                success: function () {
                                    //Eliminando la fila de la tabla HTML
                                    $(eliminar).closest('tr').fadeOut(1000, function () {
                                        $(this).remove();
                                    });
                                }
                            });
                        }
                    });
                }
            });

            //Declaraciones de variables
            $("#btnAgregar").click(function (e) {
                e.preventDefault();
                var nombre_hospital = $("#nombre_hospital").val();
                var ciudad = $("#ciudad").val();
                var departamento = $("#departamento").val();
                var direccion = $("#direccion").val();
                var pais = $("#pais").val();

                var valido = true;
                //Validar Hospitales
                if (nombre_hospital == "" || nombre_hospital.length === 0) {
                    alert("El Nombre Del Hospital Está Vacío");
                    valido = false;
                }

                if (ciudad == "" || ciudad.length === 0) {
                    alert("La Ciudad Está Vacío");
                    valido = false;
                }

                if (departamento == "" || departamento.length === 0) {
                    alert("El Departamento Está Vacía");
                    valido = false;
                }

                if (direccion == "" || direccion.length === 0) {
                    alert("La Dirección Está Vacía");
                    valido = false;
                }

                if (pais == "" || pais.length === 0) {
                    alert("El País Está Vacío");
                    valido = false;
                }

                if (valido) {
                    $.ajax({
                        url: 'http://localhost:5000/hospitals/newHospital',
                        dataType: 'json',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ "hospital_name": nombre_hospital, "city": ciudad, "department": departamento, "directions": direccion, "country": pais }),
                        processData: false,
                        success: function (data) {
                            console.log(data);
                            if (data.auth) {
                                alert("Agregue nuevo hospital");
                                form[0].reset();
                            }
                        },
                        error: function (error) {
                            console.log(error);
                            if (error.status === 403) {
                                alert("Ya existe un hospital");
                            }
                        }
                    });
                } else {
                    alert("Hay errores en el formulario");
                }
            });

            $('.btnCancelar').click(function () {
                $("#FormHospital")[0].reset();
            });


            //Inicializar la tabla dinámica
            $('#example').DataTable({
                "language": {
                    "sProcessing": "Procesando...",
                    "sLengthMenu": "Mostrar _MENU_ registros",
                    "sZeroRecords": "No se encontraron resultados",
                    "sEmptyTable": "Ningún dato disponible en esta tabla",
                    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                    "sInfoPostFix": "",
                    "sSearch": "Buscar:",
                    "sUrl": "",
                    "sInfoThousands": ",",
                    "sLoadingRecords": "Cargando...",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Último",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                    }
                }
            });
            $("select").val('10');
            $('select').addClass("browser-default");
            //$('select').material_select();
        });
    </script>
</body>

</html>