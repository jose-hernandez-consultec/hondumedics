<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lista de Administradores</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- JQuery JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!--Estilos CSS-->
    <style>
        .nav-wrapper {
            background-color: #464646;
        }

        .waves-effect.waves-pink .waves-ripple {
            background-color: #464646;
        }

        .btn-pink {
            background-color: #464646;
        }

        .btn-bordes {
            border: white 2px solid;
        }

        .page-footer {
            background: #464646;
        }

        #topbarsearch .input-field .prefix {
            width: 0rem !important;
        }

        #topbarsearch nav ul li:hover,
        nav ul li.active {
            background-color: none !important;
        }

        .input-field .prefix~input,
        .input-field .prefix~textarea,
        .input-field .prefix~label,
        .input-field .prefix~.validate~label,
        .input-field .prefix~.autocomplete-content {
            margin-left: 1rem !important;
        }

        .brand-logo {
            font-weight: 900;
        }

        .dropdown-content {
            background-color: #FFFFFF;
            margin: 0;
            display: none;
            min-width: 300px;
            /* Changed this to accomodate content width */
            max-height: auto;
            margin-left: -1px;
            /* Add this to keep dropdown in line with edge of navbar */
            overflow: hidden;
            /* Changed this from overflow-y:auto; to overflow:hidden; */
            opacity: 0;
            position: absolute;
            white-space: nowrap;
            z-index: 1;
            will-change: width, height;
        }

        .content {
            padding-left: 300px;
            height: 100%;
        }

        h1 {
            color: #448aff;
        }

        thead {
            color: black;
            background-color: #2196f3;
        }

        table.striped>tbody>tr:nth-child(odd) {
            background-color: #bbdefb;
        }
    </style>
</head>

<body>
    <!--Navbar-->
    <nav class="nav-wrapper">
        <div class="nav-wrapper">
            <a href="" class="sidenav-trigger show-on-large" data-target="menu-responsive">
                <i class="material-icons">menu</i></a>
            <div class="container">
                <a href="dashboard.html" class="brand-logo">HM Admin Panel</a>
                <ul class="right hide-on-med-and-down">
                    <!--Buscar-->
                    <li>
                        <div class="center row">
                            <div class="col s12">
                                <div class="row" id="topbarsearch">
                                    <div class="input-field col s6 s12 white-text">
                                        <i class="white-text material-icons prefix">search</i>
                                        <input type="text" placeholder="search" id="autocomplete-input"
                                            class="autocomplete white-text">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!--Notifications-->
                    <li><a class='dropdown-trigger' href='#' data-target='dropdown2'>
                            <span style="color: #464646;">Notificación</span>
                            <span class="new badge red">3</span><i class="material-icons right">notifications_none
                                <small class="notification-badge">3</small>
                            </i></a>
                    </li>

                    <!-- Dropdown Trigger -->
                    <li>
                        <a href="#" class="dropdown-trigger" data-target="dropdown1">
                            Administrador
                            <i class="material-icons right">arrow_drop_down</i>
                        </a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Dropdown Structure -->
    <ul id='dropdown1' class='dropdown-content'>
        <li><a href="Perfil.html">
                <span style="color: #464646;">
                    <center>Mi perfil</center>
                </span>
            </a></li>
        <li class="divider"></li>
        <li><a href="Configuracion.html">
                <span style="color: #464646;">
                    <center>Configuración</center>
                </span>
            </a></li>
        <li class="divider"></li>
        <li><a href="CerrarSesion.html">
                <span style="color: #464646;">
                    <center>Cerrar Sesión</center>
                </span>
            </a></li>
    </ul>

    <ul id="dropdown2" class="dropdown-content collection with-header">
        <li class="collection-header"><a href="" style="color: red;">Borrar Todo</a></li>

        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <center>
                <font face="times new roman" size=1>
                    <p class="noti-details"><span class="noti-title">Dr. Ruby Perrin</span> Schedule <span
                            class="noti-title">her appointment</span></p><span class="new badge red">1</span>
                </font>
                <font face="times new roman">
                    <p class="noti-time"><span class="notification-time">Hace 4 minutos</span></p>
                </font>
            </center>
        </li>
        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <center>
                <font face="times new roman" size=1>
                    <p class="noti-details"><span class="noti-title">Charlene Reed</span> has booked her appointment to
                        <span class="noti-title">Dr. Ruby Perrin</span></p><span class="new badge red">1</span>
                </font>
                <font face="times new roman">
                    <p class="noti-time"><span class="notification-time">Hace 10 minutos</span></p>
                </font>
            </center>
        </li>
        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <center>
                <font face="times new roman" size=1>
                    <p class="noti-details"><span class="noti-title">Travis Trimble</span> sent a amount of $210 for his
                        <span class="noti-title">appointment</span></p><span class="new badge red">1</span>
                </font>
                <font face="times new roman">
                    <p class="noti-time"><span class="notification-time">Hace 30 minutos</span></p>
                </font>
            </center>
        </li>
    </ul>




    <!-- Dropdown Structure -->
    <ul id="dropdown" class="dropdown-content collection" style="position: absolute; left: 100%;">
        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <span class="title">Name</span>
            <p>First Line</p>
            <a href="#!" class="secondary-content"><i class="material-icons">contact_mail</i></a>
        </li>
        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <span class="title">Name</span>
            <p>First Line</p>
            <a href="#!" class="secondary-content"><i class="material-icons">contact_mail</i></a>
        </li>
        <li class="collection-item avatar">
            <img src="http://materializecss.com/images/yuna.jpg" alt="" class="circle">
            <span class="title">Name</span>
            <p>First Line</p>
            <a href="#!" class="secondary-content"><i class="material-icons">contact_mail</i></a>
        </li>
    </ul>

    <!--Menú Oculto-->
    <ul class="sidenav fixed" id="menu-responsive">
        <li>
            <div class="user-view">
                <div class="background">
                    <img src="https://hdblackwallpaper.com/wallpaper/2015/04/1200-x-900-solid-black-wallpaper-22-wide-wallpaper.jpg"
                        alt="" class="responsive-img">
                </div>
                <a href="">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjf_mMlWmPrhB7-ifZVsjOgsJHDLe_QvLbLhW5bwtSW8fVNYfI&s"
                        alt="" class="circle">
                </a>
                <span class="white-text name">Admin</span>
                <span class="white-text email">admin@admin.com</span>
            </div>
        </li>
        <li>
            <a href="../hondumedics-admin/dashboard.html"><i class="material-icons black-text">dashboard</i>Dashboard
            </a>
        </li>

        <li>
            <a href="../hondumedics-admin/ListaPacientes.html"><i class="material-icons black-text">person</i>Pacientes
            </a>
        </li>

        <li>
            <a href="../hondumedics-admin/ListaDoctores.html"><i class="material-icons black-text">people</i>Doctores
            </a>
        </li>
        <li>
            <a href="../hondumedics-admin/ListaCitas.html"><i class="material-icons black-text">date_range</i>Citas
            </a>
        </li>
        <li>
            <a href="../hondumedics-admin/ListaHospitales.html"><i
                    class="material-icons black-text">local_hospital</i>Hospitales
            </a>
        </li>
        <li>
            <a href="../hondumedics-admin/ListaEspecialidades.html"><i
                    class="material-icons black-text">format_align_justify</i>Especialidades
            </a>
        </li>
        <li>
            <a href="../hondumedics-admin/ListaEnfermedades.html"><i
                    class="material-icons black-text">format_align_justify</i>Enfermedades
            </a>
        </li>
        <div class="divider"></div>

        <li>
            <a href="../hondumedics-admin/AgregarNuevoUsuario.html"><i class="material-icons black-text">add</i>Agregar
                Nuevo Usuario
            </a>
        </li>
        <li>
            <a href=""><i class="material-icons black-text">exit_to_app</i>Cerrar Sesión
            </a>
        </li>
    </ul>
    <!--SideNav Finished-->

    <!--Lista de Administradores-->
    <center>
        <div class="container">
            <div class="row">
                <br>
                <br>
                <h1>Lista de Administradores</h1>
                <br>
                <br>
                <table id="tabla1" class="striped centered">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NOMBRE DE USUARIO</th>
                            <th>NOMBRES</th>
                            <th>APELLIDOS</th>
                            <th>CORREO</th>
                            <th>ACCESO</th>
                            <th>ACCIONES</th>
                        </tr>
                    </thead>

                    <tbody>
                        <!--<tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>-->
                    </tbody>
                </table>
            </div>
        </div>
    </center>
    <script>
        //Este método se utiliza para hacer que una función esté disponible después de cargar el documento.
        $(document).ready(function () {
            //Inicialización de las propiedades de Materialize css.
            M.AutoInit();
            $('.sidenav').sidenav();
            $('.sidenav-trigger').sidenav();
            $('.dropdown-trigger').dropdown({
                coverTrigger: false,
                belowOrigin: true
            });

            //Método Ajax, permite al navegador enviar y recibir datos en  el fondo (background).
            $.ajax({
                url: 'https://hondumedics-server.herokuapp.com/admins',
                type: 'GET',
                dataType: 'json', //added data
                success: function (data) {
                    console.log(data);
                    var datos = data;
                    for (var i = 0; i <= datos.length; i++) {
                        if (datos[i] != undefined) { //Validar de que el ID no venga nulo o indefinido
                            $('.tooltipped').tooltip();

                            //Se eliminó el atributo ID y el id se agregó como una clase
                            //Se le agregó el atributo data-adminid a cada uno de los 3 botones
                            $("#tabla1").append('<tr>' + '<td>' + datos[i].admin_id + '</td>' + '<td>' + datos[i].username + '</td>' + '<td>' + datos[i].first_name + '</td>' + '<td>' + datos[i].last_name + '</td>' + '<td>' + datos[i].email + '</td>' + '<td>' + datos[i].access + '</td>' + '<td><a style="position:relative;z-index:0;" class="btnEditar btn-floating btn-small waves-effect waves-light green btn tooltipped center" data-position="bottom" data-tooltip="Editar" data-adminid=' + datos[i].admin_id + ' data-adminfirstname=' + datos[i].first_name + ' data-adminlastname=' + datos[i].last_name + ' data-adminusername=' + datos[i].username + ' data-adminaccess=' + datos[i].access + '><i class="material-icons">edit</i></a><a style="position:relative;z-index:0;" class="btnEliminar btn-floating btn-small waves-effect waves-light red btn tooltipped right" data-position="bottom" data-tooltip="Eliminar" data-adminid=' + datos[i].admin_id + '><i class="material-icons">delete_forever</i></a></td>' + '</tr>');
                        }

                    }
                    
                    //El método click() adjunta una función de controlador de eventos a un elemento HTML.
                    //La función se ejecuta cuando el usuario hace clic en el elemento HTML.
                    //Función Click del boton Editar
                    $(".btnEditar").click(function () {
                        var admin_id = parseInt($(this).attr("data-adminid"));
                        var admin_first_name = String($(this).attr("data-adminfirstname"));
                        var admin_last_name = String($(this).attr("data-adminlastname"));
                        var admin_username = String($(this).attr("data-adminusername"));
                        var admin_access = String($(this).attr("data-adminaccess"));
                        console.log(admin_id);
                        console.log("Editar");

                        //Redireccionando a editarAdministrador.html y enviando dos parámetros hacia esa página: first_name y last_name
                        //window.location.href = "./editarAdministrador.html?first_name=" + admin_first_name + "&last_name=" + admin_last_name;
                        window.location.href = "./editarAdministrador.html?admin_id=" + admin_id + "&first_name=" + admin_first_name + "&last_name=" + admin_last_name + "&username=" + admin_username + "&access=" + admin_access;
                    });

                    //Función Click del boton Eliminar
                    $(".btnEliminar").click(function () {
                        //Declarar variable eliminar
                        var eliminar = this;

                        //Eliminar ID con atributo data
                        var admin_id = $(this).data("adminid");
                        console.log(admin_id);
                        console.log("Eliminar");

                        if (confirm("¿Estás seguro de que deseas eliminar esta fila?")) {

                            //Método Ajax, permite al navegador enviar y recibir datos en  el fondo (background).
                            $.ajax({
                                url: 'https://hondumedics-server.herokuapp.com/admins/deleteAdmin',
                                type: 'POST',
                                dataType: "json",
                                contentType: "application/json",
                                data: JSON.stringify({ "admin_id": admin_id }),
                                success: function () {
                                    //Eliminando la fila de la tabla HTML
                                    $(eliminar).closest('tr').fadeOut(1000, function () {
                                        $(this).remove();
                                    });
                                }
                            });
                        }
                    });
                }
            });
        });
    </script>

</body>

</html>